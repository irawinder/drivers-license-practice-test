# Japanese Driver's License Practice Test Data

## Project Overview

Structured data extracted from a 41-page PDF of Japanese driver's license practice tests (English translation).

- **820 questions total**: 250 Learner's Permit (5 exams x 50) + 570 Driver's License (6 exams x 95, where questions 91-95 are "danger anticipation" questions with 3 sub-questions each)
- **All True/False format**
- **202 cropped question/reference images**: 185 exam question images + 17 reference images (including danger anticipation guide)

## Directory Structure

```
docs/                     # GitHub Pages study app (static SPA)
  index.html              # Single-page app shell (Home, Study, Reference, Stats views)
  style.css               # Mobile-first responsive styles
  app.js                  # Application logic (question selection, progress tracking)
  data/
    questions.json        # 880 flattened T/F flashcards (generated by build script)
    reference.json        # Reference material with rewritten image paths
  images/                 # 202 copied question/reference PNGs
extracted/
  images/                 # 41 full-page PNGs (300 DPI, 0-indexed: page_00_cover.png ... page_40_answers_dl6.png)
  question_images/        # 202 cropped per-question and reference PNGs
  learners_permit_exam_{1-5}.json
  drivers_license_exam_{1-6}.json
  reference_material.json
  image_annotations.json  # Bounding box data used to crop question images from page images
build_site_data.py        # Builds docs/ from extracted/ (flattens questions, copies images)
image_annotator.py        # Local annotation tool server (port 8765)
image_annotator.html      # Annotation tool UI
DriversLicenseExaminationPracticeTests.pdf
```

## Data Schemas

### Learner's Permit Exam (`learners_permit_exam_{1-5}.json`)

```json
{
  "exam_type": "learners_permit",
  "exam_number": 1,
  "total_questions": 50,
  "passing_score": 45,
  "time_limit_minutes": 30,
  "questions": [
    {
      "number": 1,
      "text": "...",
      "has_image": false,
      "image_description": null,
      "correct_answer": "T" | "F",
      "explanation": "...",
      "image_file": null | "question_images/lp1_q03.png"
    }
  ]
}
```

### Driver's License Exam (`drivers_license_exam_{1-6}.json`)

```json
{
  "exam_type": "drivers_license",
  "exam_number": 1,
  "total_questions": 95,
  "passing_score": 90,
  "time_limit_minutes": 50,
  "questions": [
    {
      "number": 1,
      "type": "true_false",
      "text": "...",
      "has_image": false,
      "image_description": null,
      "correct_answer": "T" | "F",
      "explanation": "...",
      "image_file": null | "question_images/dl1_q36.png"
    }
  ],
  "danger_questions": [
    {
      "number": 91,
      "scenario": "...",
      "image_description": "...",
      "has_image": true,
      "image_file": "question_images/dl1_q91.png",
      "sub_questions": [
        {
          "number": 1,
          "text": "...",
          "correct_answer": "T" | "F",
          "explanation": "..."
        }
      ]
    }
  ]
}
```

Note: DL regular questions have a `type` field ("true_false"); LP questions do not.

### Reference Material (`reference_material.json`)

```json
{
  "type": "reference_material",
  "key_points_to_remember": {
    "sections": [
      {
        "title": "SECTION TITLE",
        "image_file": "question_images/ref_hand_signals.png",  // optional, section-level image
        "points": [
          "Simple string point",
          {
            "text": "Point with inline image",
            "image_file": "question_images/ref_sign_road_blocked.png"
          }
        ]
      }
    ]
  }
}
```

Points are either plain strings or `{text, image_file}` objects. Some sections have a section-level `image_file`.

## Image Naming Conventions

- **LP exam questions**: `lp{exam_num}_q{number:02d}.png` (e.g. `lp1_q03.png`, `lp5_q49.png`)
- **DL exam questions**: `dl{exam_num}_q{number:02d}.png` (e.g. `dl1_q36.png`, `dl4_q91.png`)
- **Reference images**: `ref_*.png` (e.g. `ref_hand_signals.png`, `ref_shifting_lanes.png`)
- All `image_file` paths in JSON are relative to the `extracted/` directory

## Study App (`docs/`)

Static single-page app deployed via GitHub Pages. Vanilla HTML/CSS/JS, no frameworks, no build tools.

- **880 flashcards**: 250 LP + 540 DL standard + 90 danger sub-questions (flattened from 30 danger scenarios x 3 each)
- **Spaced repetition**: wrong questions re-presented with highest priority; mastery requires 2 correct answers in a row
- **Progress in localStorage** under key `jdl_progress` (persists across refreshes, per-question correct/wrong/streak)
- **Question selection**: weighted random from buckets (wrong > unseen > in-progress > mastered) with anti-repetition (skips last 10 shown)
- **Views**: Home (filter + progress), Study (card + T/F + explanation), Reference (accordion), Stats (per-category breakdown)

### Rebuilding site data

```bash
python3 build_site_data.py
```

Reads `extracted/*.json`, flattens into `docs/data/questions.json` (880 entries), copies `docs/data/reference.json`, and copies 202 PNGs to `docs/images/`.

### Local testing

```bash
cd docs && python3 -m http.server 8000
```

## Tools

- **`build_site_data.py`**: Generates `docs/data/` and `docs/images/` from `extracted/`. Run from repo root.
- **`image_annotator.py` + `image_annotator.html`**: Web-based annotation tool for drawing bounding boxes on page images and tagging them with question/reference IDs. The server crops images using Pillow. Run with `/tmp/pdfenv/bin/python image_annotator.py` (serves on port 8765).
- **PDF extraction**: Used PyMuPDF (fitz) at 300 DPI. Python environment at `/tmp/pdfenv/` (may need recreation if `/tmp` was cleaned).
